---
title: Data from Ontogenetic thermal tolerance and performance of ectotherms at variable
  temperatures
author: Jeff Walker
date: '2018-05-26'
slug: data-from-ontogenetic-thermal-tolerance-and-performance-of-ectotherms-at-variable-temperatures
categories: []
tags:
  - experiment
  - 2x2
  - physiology
subtitle: ''
output:
  blogdown::html_page:
    toc: true
---
# Background

Explored changes in thermal performance curve in response to rearing at 1 of 4 temperature classes (2 mean temperatures x 2 temperature fluctations). Compared to Huey & Kingsolver's three evolutionary responses, so considered this an ontogenetic response. The three kinds of responses are 1) right shift in upper thermal limit (UTL), 2) right shift in whole curve -- so increase in UTL but decrease in lower thermal limit (LTL) - this is a trade-off, 3) increase in both UTL and LTL, which broadens the thermal performance (Thermal breath (Tbr) and possibly Optimal Range (OR))

Just looking at their Fig. 2, the response was a right shift of the whole curve. They used a model selection procedure to reduce to a minimum adequate model but this is a case where they want estimates for LTL, UTL, TB, and OR to compare to the H&K models!

# Summary of reproducibility

Table 1 - mostly reproducible but rounding error.

Table 2 - partly reproducible but less important for inference

# Reproducibility
```{r libraries, echo=TRUE, message=FALSE}
library(knitr)
library(readxl)
library(ggplot2)
library(doBy)
library(data.table)
library(MuMIn)
library(emmeans)
library(cowplot)
library(HarrellPlot)
```

```{r data}
base_path <- "../data" #knitr
#base_path <- "content/data"  # console

folder <- '2018-05-26-data-from-ontogenetic-thermal-tolerance'
fn <- 'data_cavieres et al JEB 2016.xls'
file_path <- paste(base_path,folder, fn, sep='/')
dt <- data.table(read_excel(file_path))
old_colnames <- colnames(dt)
ycols <- c('Tbar', 'Tfluc', 'Sex', 'X1', 'X2', 'OR', 'To', 'Vmax', 'Tbr', 'LTL', 'UTL')
setnames(dt, old_colnames, ycols)
dt[,Tbar:=factor(Tbar, c('15','28'))]
dt[,Tfluc:=factor(Tfluc, c('0','4'))]
# order by factor for HarrelPlot
dt <- orderBy(~ Tbar + Tfluc, dt)
```

The authors used a model selection method to get something like minimum adequate model for the effects of $Sex$ + $Tbar$ + $Tfluc$ on 8 performance curve traits. The model selection method was

>To test the potential effects of mean of temperature and daily fluctuation, we performed a linear model, with following variables: sex + mean of temperature * daily fluctuation. Model selection was performed using Akaikeâ€™s information criterion for finites sample (AICc); both delta AIC (Di) values, a measure of each model relative to the best model, and model weights (wi), a measure of the evidence supporting a specific model, were used for selections and model comparison. When there were multiple models with Di < 2, selection was based on the difference in parameters present in each model, reduction in deviance and log-likelihood values (Burnham & Anderson, 2003)

"selection was based on the difference in parameters present in each model, reduction in deviance and log-likelihood" is not reproducible language.

## Table 1

```{r table1}
ycols <- c('To', 'Vmax', 'Tbr', 'LTL', 'UTL', 'OR', 'X1', 'X2')
table1 <- list()
for(j in 1:length(ycols)){
  full_model <- formula(paste(ycols[j], "~ Sex + Tbar*Tfluc"))
  fit <- lm(full_model, data=dt, na.action=na.fail)
  fit.all <- dredge(fit)
  table1[[j]] <- round(coefficients(summary(get.models(fit.all, subset=1)[[1]])), 3)
}
names(table1) <- ycols
table1
```

Table 1 reproducibility

1. $T_o$ reproduces
2. $Vmax$ cannot recover
3. $Tbar$ reproduces
4. $LTL$ reproduces *except* sex effect. The authors seem to have merely not reported the Sex effect -- otherwise how to explain equivalence of coefficients, SE, and T
5. $UTL$ reproduces
6. $OR$ reproduces
7. $X1$ reproduces
8. $X2$ reproduces
 
## Table 2

These seem to be estimated marginal means, presumably from the models in Table 1. But this can't be because 28C-15 != 28V-15V for $T_o$ and others. Also, $OR$ is not simply the intercept (and must have an interaction too).

Tried various combinations. The closest that comes to reproducing is the full model ($Sex + Tbar*Tfluc$).

```{r table2}
dredge_it <- FALSE
table2 <- list()
for(j in 1:length(ycols)){
  full_model <- formula(paste(ycols[j], "~ Sex + Tbar * Tfluc"))
  fit <- lm(full_model, data=dt, na.action=na.fail)
  if(dredge_it){
    fit.all <- dredge(fit)
    fit <- get.models(fit.all, subset=1)[[1]]
    best_vars <- all.vars(formula(fit))[-1] # if using dredge
    if(length(best_vars > 0)){
      table2[[j]] <- emmeans(fit, specs=best_vars)
    }else{
      table2[[j]] <- coefficients(fit)[1]
    }    
  }else{
      table2[[j]] <- emmeans(fit, specs=c('Tbar', 'Tfluc'))
  }
}
names(table2) <- ycols
table2

```

Table 2 reproducibility -- partial.

Regardless, this makes little difference to the inference.

## Table 3

Is this correlated change across the trial temperatures? There is no data for this!

## Figure 2

The data to re-plot Figure 2 were not made available.

# Post-publication review
## Use the full model to compare to Huey & Kinsolver

To compare to H&K models, we need estimates for change in $LTL$, $UTL$, $Tbr$ and possibly $OR$ across treatment effects. If the interaction is smallish, report the pooled effects across both levels of the other treatment. Otherwise report the simple effects (differences within each level of the other treatment).

```{r fullmodels}
ycols <- c('To', 'Vmax', 'Tbr', 'LTL', 'UTL', 'OR', 'X1', 'X2')
table_list <- list()
gg_list <- list()
for(j in 1:length(ycols)){
  
  res <- HarrellPlot(x="Tfluc", y=ycols[j], g="Tbar", data=dt, 
                     add_interaction=TRUE, interaction.group = TRUE, 
                     contrasts.method='revpairwise')
  table_list[[j]] <- res$tables$contrasts
  gg_list[[j]] <- res$gg
}
names(table_list) <- ycols
names(gg_list) <- ycols
```

```{r fullModelTables}
table_list
```

```{r fullModelPlots}
gg_list
```

1. $T_o$

2. $Tbr$ is noisy relative to signal but the pattern is small decrease in $Tbr$ given temperature flucation but no change in mean and small increase in $Tbr$ given change in temperature regardless of fluctuation.

3. $LTL$ increases with mean temp in both constant and fluctuating T levels but simple fluctuation (with no increase in mean temperature) has effectively zero response.

4. $UTL$ increase with mean temp in fluctuation level but only small increase with mean temp in no-fluctuation level. Increase with fluctuation at both mean temperature levels.

5. $OR$

## Shift in UTL
> in variable environments the upper thermal limit of performance curve shifted to the right, but flies reared in constant environments did not exhibit changes in UTL and the curve did not shift.

Note that their Fig. 2 shows a clear right shift even in the non-fluctuating environment but an anomaly with the data at 40 degrees where the high temperature treatment is unusually low.

They don't really present evidence for this anywhere but a HarrellPlot does a good job. The first two contrasts are the $Tbar$ effect, which is the evidence for the shift to right in fluctuating environment vs. non fluctuating environment. The bottom two contrasts are the $Tfluc$ effect.

The HarrellPlot supports the conclusion but the conclusion is unsupported by their own presentation as it implies a $Tbar \times Tfluc$ interaction (that is, the effect of $Tbar$ depends on the level of $Tfluc$). But nowhere do they show this interaction. Their own "best model" for $UTL$ does not include the interaction but just the additve effects of $Tbar$ and $Tfluc$.

# Red Flags
1. "Nevertheless, Tbr was not affected by environmental variability." P > 0.05 != "no effect"