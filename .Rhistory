their.anova.table
my.anova.table
blogdown:::serve_site()
# FRB ~ treatment + season + (1 | plot) + (1 | month)
res5 <- anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3)
anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
res5 <- anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3)
anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3)
anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3, ddf="ken")
anova(lmer(form, REML=FALSE, data=frb[depth=="5"]), type=3, ddf="Kenward-Roger")
anova(lmer(form, REML=TRUE, data=frb[depth=="5"]), type=3, ddf="Kenward-Roger")
anova(lmer(form, REML=TRUE, data=frb[depth=="5"]), type=3, ddf="lme4")
blogdown:::serve_site()
anova(lm(FRB ~ season, data=FRB[depth=="5"]))
anova(lm(FRB ~ season, data=frb[depth=="5"]))
anova(lm(FRB ~ season, data=frb[depth=="5"]))
anova(lm(FRB ~ season, data=frb[depth=="10"]))
anova(lm(FRB ~ season, data=frb[depth=="5"]))
anova(lm(FRB ~ season, data=frb[depth=="10"]))
frb5 <- frb[depth==5, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb10 <- frb[depth==10, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb_sum <- rbind(data.table(depth=5, frb5), data.table(depth=10, frb10))
frb_sum[, Lower:=FRB-SE]
frb_sum[, Upper:=FRB+SE]
frb_sum[, season:=factor(season, c('wet', 'dry'))]
frb_sum[, treatment:=factor(treatment, c('LR', 'CT', 'LA'))]
pd <- position_dodge(.6)
gg <- ggplot(data=frb_sum, aes(x=season, y=FRB, fill=treatment)) +
geom_col(position=pd, width=0.6, color='black') +
geom_errorbar(aes(ymin=Lower, ymax=Upper), width=.2, position=pd) +
scale_fill_manual(values=c("white", "gray", "black")) +
facet_grid(.~depth, labeller = label_both) +
theme_minimal(base_size=14)
gg
image_path <- paste("../images", folder, fn, sep="/")
knitr::include_graphics(image_path)
fn <- "fig1.png"
image_path <- paste("../images", folder, fn, sep="/")
knitr::include_graphics(image_path)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
fit5 <- lmer(form, REML=FALSE, data=frb[depth=="5"])
res5 <- anova(fit5, type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="10"], reml=FALSE)
# FRB ~ season + (1 | plot) + (1 | month)
res10 <- anova(lmer(form, REML=FALSE, data=frb[depth=="10"]), type=3)
my.anova.table <- data.table(response="FRB",
depth=5,
NDF=res5["season", "NumDF"],
DDF=res5["season", "DenDF"],
F=res5["season", "F value"],
p=res5["season", "Pr(>F)"])
my.anova.table <- rbind(my.anova.table,
data.table(response="FRB",
depth=10,
NDF=res10["season", "NumDF"],
DDF=res10["season", "DenDF"],
F=res10["season", "F value"],
p=res10["season", "Pr(>F)"]))
fit5.emm <- emmeans(fit5, specs="treatment")
fit5.emm <- emmeans(fit5, specs="treatment")
contrast(fit5.emm, method="revpairwise")
?contrast
fit5.emm <- emmeans(fit5, specs="treatment")
contrast(fit5.emm, method="revpairwise")
CLD(fit5.emm)
library(multcompView)
install.packages("multcompView")
library(multcompView)
library(readxl)
library(ggplot2)
library(ggpubr)
library(lmerTest)
library(emmeans)
library(data.table)
library(multcompView) # grouping post hoc (not recommended!)
data_folder <- "../data"
folder <- "Data from Litter removal in a tropical rain forest reduces fine root biomass and production but litter addition has few effects"
# images need to be moved to /static/images/data from.../image.png
knitr_path <- FALSE
fit5.emm <- emmeans(fit5, specs="treatment")
contrast(fit5.emm, method="revpairwise")
CLD(fit5.emm)
# what are these "FRB5cmJul13__1", "FRB10cmJul13__1" they have values more like FRL than FRB and physically they are within the FRL set of columns (in the exact place of FRL5cmJul and FRL10cmJul)
frb <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=FRB_cols, variable.name='label', value.name='FRB')
# root is in wide format - reshape to long
FRB_cols <- c("FRB5cmMar13", "FRB5cmApr13", "FRB5cmMay13", "FRB5cmJun13", "FRB5cmJul13", "FRB5cmAug13", "FRB5cmSep13", "FRB5cmOct13", "FRB5cmNov13", "FRB5cmDec13", "FRB5cmJan14", "FRB5cmFeb14", "FRB10cmMar13", "FRB10cmApr13", "FRB10cmMay13", "FRB10cmJun13", "FRB10cmJul13", "FRB10cmAug13", "FRB10cmSep13", "FRB10cmOct13", "FRB10cmNov13", "FRB10cmDec13")
# what are these "FRB5cmJul13__1", "FRB10cmJul13__1" they have values more like FRL than FRB and physically they are within the FRL set of columns (in the exact place of FRL5cmJul and FRL10cmJul)
frb <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=FRB_cols, variable.name='label', value.name='FRB')
frb[, treatment:=factor(treatment)] #CT-control; LA-litter addition; LR-litter removal
frb[, label:=as.character(label)]
frb[, depth:=factor(ifelse(substr(label, 4, 4)=='5', 5, 10))] # depth is 4th character in label
frb[, month:=substr(label, nchar(label)-4, nchar(label)-2)] # month is in label
dry <- c('Jan', 'Feb', 'Mar', 'Apr')
wet <- c("May", "Jun", "Jul", "Aug")
frb[, season:=factor(ifelse(month %in% dry, 'dry', 'wet'))]
frb[, season2:=factor(ifelse(month %in% dry, 'dry',
ifelse(month %in% wet, "wet", "transitional")))]
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
fit5 <- lmer(form, REML=FALSE, data=frb[depth=="5"])
res5 <- anova(fit5, type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="10"], reml=FALSE)
# FRB ~ season + (1 | plot) + (1 | month)
res10 <- anova(lmer(form, REML=FALSE, data=frb[depth=="10"]), type=3)
my.anova.table <- data.table(response="FRB",
depth=5,
NDF=res5["season", "NumDF"],
DDF=res5["season", "DenDF"],
F=res5["season", "F value"],
p=res5["season", "Pr(>F)"])
my.anova.table <- rbind(my.anova.table,
data.table(response="FRB",
depth=10,
NDF=res10["season", "NumDF"],
DDF=res10["season", "DenDF"],
F=res10["season", "F value"],
p=res10["season", "Pr(>F)"]))
my.anova.table
ic_cols <- c("ICAug13-Oct13", "ICOct13-Jan14", "ICJan14-Apr14")
ic <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=ic_cols, variable.name='label', value.name='frb_prod')
head(ic)
ic_cols <- c("ICAug13-Oct13", "ICOct13-Jan14", "ICJan14-Apr14")
ic <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=ic_cols, variable.name='label', value.name='frb_prod')
ic[, season:=factor(ifelse(label=="ICAug13-Oct13", "wet",
ifelse(label=="ICOct13-Jan14", "transitional", "dry")))]
head(ic)
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
form
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
res5 <- anova(frb_prod.fit, type=3)
frb_prod.emm
frb_prod.anova
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
anova(lm(frb_prod ~ season, data=ic))
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
anova(lm(frb_prod ~ season, data=ic))
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=TRUE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=TRUE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3, ddf="kenward-rogers")
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=TRUE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3, ddf="Satterthwaite")
frb_prod.anova <- anova(frb_prod.fit, type=3, ddf="Kenward-Roger")
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=TRUE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
anova(frb_prod.fit, type=3, ddf="Satterthwaite")
anova(frb_prod.fit, type=3, ddf="Kenward-Roger")
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=TRUE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
anova(frb_prod.fit, type=3, ddf="Satterthwaite")
anova(frb_prod.fit, type=3, ddf="Kenward-Roger")
anova(frb_prod.fit, ddf="Satterthwaite")
anova(lmer(frb_prod ~ season + (1 | plot), REML=TRUE, data=ic), ddf="Satterthwaite")
anova(lmer(frb_prod ~ treatment + season + (1 | plot), REML=TRUE, data=ic), ddf="Satterthwaite")
anova(lmer(frb_prod ~ treatment*season + (1 | plot), REML=TRUE, data=ic), ddf="Satterthwaite")
dim(ic)
ic
AIC(lmer(frb_prod ~ season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment + season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment*season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment + season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment*season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment*season, REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment + season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment*season + (1 | plot), REML=FALSE, data=ic))
AIC(lm(frb_prod ~ treatment*season, data=ic))
AIC(lmer(frb_prod ~ season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment + season + (1 | plot), REML=FALSE, data=ic))
AIC(lmer(frb_prod ~ treatment*season + (1 | plot), REML=FALSE, data=ic))
AIC(lm(frb_prod ~ treatment*season, data=ic))
AIC(lm(frb_prod ~ treatment+season, data=ic))
AIC(lm(frb_prod ~ season, data=ic))
anova(lm(frb_prod ~ season, data=ic))
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
df<-structure(list(Month = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L,1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L,2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,3L, 3L, 3L, 3L, 3L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L,4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 6L, 6L, 6L,6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L,6L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L,7L, 7L, 7L, 7L, 7L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L,8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L,9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L), .Label = c("2", "3", "4", "5","6", "7", "8", "9", "11"), class = "factor"), Treatment = structure(c(2L,2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L,2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L,1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L,2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L,1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L,2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L,2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L,1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L,2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L,1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L,2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L), .Label = c("1","2"), class = "factor"), Counts = c(10L, 25L, 6L, 10L, 5L, 11L,8L, 20L, 13L, 6L, 8L, 11L, 0L, 0L, 21L, 4L, 23L, 1L, 23L, 1L,11L, 21L, 0L, 0L, 1L, 0L, 1L, 6L, 9L, 0L, 2L, 1L, 1L, 0L, 9L,65L, 21L, 0L, 1L, 3L, 0L, 0L, 11L, 25L, 5L, 14L, 8L, 52L, 17L,7L, 14L, 0L, 0L, 9L, 43L, 0L, 32L, 5L, 9L, 1L, 50L, 52L, 17L,60L, 13L, 8L, 1L, 37L, 71L, 12L, 22L, 21L, 2L, 12L, 62L, 40L,30L, 11L, 1L, 10L, 10L, 23L, 2L, 41L, 1L, 7L, 2L, 18L, 7L, 0L,2L, 3L, 6L, 0L, 37L, 19L, 20L, 6L, 5L, 0L, 33L, 30L, 8L, 50L,0L, 2L, 0L, 2L, 1L, 3L, 1L, 10L, 0L, 2L, 10L, 0L, 0L, 0L, 1L,1L, 10L, 7L, 7L, 2L, 1L, 5L, 0L, 9L, 3L, 0L, 2L, 5L, 1L, 5L,9L, 0L, 7L, 20L, 56L, 0L, 28L, 62L, 9L, 1L, 4L, 0L, 0L, 18L,0L, 7L, 12L, 8L, 5L, 11L, 28L, 5L, 0L, 1L, 0L, 11L, 9L, 42L,18L, 0L, 1L, 10L, 1L, 5L, 1L, 4L, 3L, 8L, 31L, 6L, 5L)), row.names = c(NA,-175L), class = "data.frame")
df
df<-structure(list(Month = structure(c(1L, 1L, 1L, 1L, 1L, 1L, 1L,1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 2L, 2L, 2L,2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L, 2L,2L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L, 3L,3L, 3L, 3L, 3L, 3L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L,4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 4L, 5L, 5L, 5L, 5L, 5L, 5L, 5L,5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 5L, 6L, 6L, 6L,6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L, 6L,6L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L, 7L,7L, 7L, 7L, 7L, 7L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L,8L, 8L, 8L, 8L, 8L, 8L, 8L, 8L, 9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L,9L, 9L, 9L, 9L, 9L, 9L, 9L, 9L), .Label = c("2", "3", "4", "5","6", "7", "8", "9", "11"), class = "factor"), Treatment = structure(c(2L,2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L,2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L,1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L,2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L,1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L,2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L,2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L,1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L, 1L, 2L, 2L, 2L,2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 1L,1L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 2L, 1L, 2L, 1L, 1L, 2L, 2L,2L, 2L, 2L, 2L, 2L, 1L, 1L, 1L, 1L, 1L, 2L, 1L, 1L, 1L), .Label = c("1","2"), class = "factor"), Counts = c(10L, 25L, 6L, 10L, 5L, 11L,8L, 20L, 13L, 6L, 8L, 11L, 0L, 0L, 21L, 4L, 23L, 1L, 23L, 1L,11L, 21L, 0L, 0L, 1L, 0L, 1L, 6L, 9L, 0L, 2L, 1L, 1L, 0L, 9L,65L, 21L, 0L, 1L, 3L, 0L, 0L, 11L, 25L, 5L, 14L, 8L, 52L, 17L,7L, 14L, 0L, 0L, 9L, 43L, 0L, 32L, 5L, 9L, 1L, 50L, 52L, 17L,60L, 13L, 8L, 1L, 37L, 71L, 12L, 22L, 21L, 2L, 12L, 62L, 40L,30L, 11L, 1L, 10L, 10L, 23L, 2L, 41L, 1L, 7L, 2L, 18L, 7L, 0L,2L, 3L, 6L, 0L, 37L, 19L, 20L, 6L, 5L, 0L, 33L, 30L, 8L, 50L,0L, 2L, 0L, 2L, 1L, 3L, 1L, 10L, 0L, 2L, 10L, 0L, 0L, 0L, 1L,1L, 10L, 7L, 7L, 2L, 1L, 5L, 0L, 9L, 3L, 0L, 2L, 5L, 1L, 5L,9L, 0L, 7L, 20L, 56L, 0L, 28L, 62L, 9L, 1L, 4L, 0L, 0L, 18L,0L, 7L, 12L, 8L, 5L, 11L, 28L, 5L, 0L, 1L, 0L, 11L, 9L, 42L,18L, 0L, 1L, 10L, 1L, 5L, 1L, 4L, 3L, 8L, 31L, 6L, 5L)), row.names = c(NA,-175L), class = "data.frame")
m1<-glmer(data = df, Counts~Treatment + (1|Month), family = 'poisson')
m2<-lmer(data = df, Counts~Treatment + (1|Month))
m3<-glmer.nb(data = df, Counts~Treatment + (1|Month), family = 'poisson')
m4<-lmer(sqrt(df$Counts)~df$Treatment + (1|df$Month))
AICctab(m1,m2,m3, m4,base = T, weights = T)
library(DHARMa)
n_sim <- 250
simulationOutput <- simulateResiduals(fittedModel = m1, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m1, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m3, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m4, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m1, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m1, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m2, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m3, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m4, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m1, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m2, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m3, n = n_sim)
plot(simulationOutput, asFactor = F)
simulationOutput <- simulateResiduals(fittedModel = m4, n = n_sim)
plot(simulationOutput, asFactor = F)
plot(m2)
plot(m4)
simulationOutput <- simulateResiduals(fittedModel=m3, n=n_sim, refit=TRUE)
plot(simulationOutput, asFactor = F)
testDispersion(simulationOutput)
head(predict(m3))
head(predict(glmer.nb(data = df, Counts~Treatment + (1|Month))))
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
blogdown:::serve_site()
library(readxl)
library(ggplot2)
library(ggpubr)
library(lmerTest)
library(emmeans)
library(data.table)
library(multcompView) # grouping post hoc (not recommended!)
data_folder <- "../data"
folder <- "Data from Litter removal in a tropical rain forest reduces fine root biomass and production but litter addition has few effects"
# images need to be moved to /static/images/data from.../image.png
knitr_path <- FALSE
select_model <- function(y, x, r, dt, reml=FALSE){
# the data are in dt
# y is the response column name
# x is the list of fixed effect column names
# r is the list of random effect column names
# it would seem weird to have both month and plot in model
# see 5.7 of Zuur for model selection of mixed effect models
fixed <- paste(y,"~", paste(x, collapse='*'))
random <- list()
random[[1]] <- paste(paste("(1|", r, ")", sep=""), collapse=" + ")
min_aic <- 1
# fit random part first, if there are > 1 random variables
if(length(r) > 1){
aic <- numeric(3)
form <- formula(paste(fixed, random[[1]], sep=' + '))
fit1 <- lmer(form, data=dt, REML=TRUE)
aic[1] <- AIC(fit1)
r1 <- r[1] # just the first random element
random[[2]] <- paste(paste("(1|", r1, ")", sep=""), collapse=" + ")
form <- formula(paste(fixed, random[[2]], sep=' + '))
fit2 <- lmer(form, data=dt, REML=TRUE)
aic[2] <- AIC(fit2)
r2 <- r[2] # just the second random element
random[[3]] <- paste(paste("(1|", r2, ")", sep=""), collapse=" + ")
form <- formula(paste(fixed, random[[3]], sep=' + '))
fit3 <- lmer(form, data=dt, REML=TRUE)
aic[3] <- AIC(fit3)
min_aic <- which(aic == min(aic))
}
random <- random[[min_aic]]
# fit fixed part
form <- list()
# fit with ML, choose model, then refit with REML
aic <- numeric(4)
form[[1]] <- formula(paste(fixed, random, sep=' + '))
# default is REML
fit1 <- lmer(form[[1]], data=dt, REML=reml)
aic[1] <- AIC(fit1)
fixed <- paste(y,"~", paste(x, collapse=' + '))
form[[2]] <- formula(paste(fixed, random, sep=' + '))
fit2 <- lmer(form[[2]], data=dt, REML=reml)
aic[2] <- AIC(fit2)
fixed <- paste(y,"~", x[1])
form[[3]] <- formula(paste(fixed, random, sep=' + '))
fit3 <- lmer(form[[3]], data=dt, REML=reml)
aic[3] <- AIC(fit3)
fixed <- paste(y,"~", x[2])
form[[4]] <- formula(paste(fixed, random, sep=' + '))
fit4 <- lmer(form[[4]], data=dt, REML=reml)
aic[4] <- AIC(fit4)
min_aic <- which(aic == min(aic))
return(form[[min_aic]])
}
fn <- 'Root_Ecology_supplementary_materials.xlsx'
file_path <- paste(data_folder, folder, fn, sep='/')
root <- data.table(read_excel(file_path, range = cell_rows(1:16)))
# root is in wide format - reshape to long
FRB_cols <- c("FRB5cmMar13", "FRB5cmApr13", "FRB5cmMay13", "FRB5cmJun13", "FRB5cmJul13", "FRB5cmAug13", "FRB5cmSep13", "FRB5cmOct13", "FRB5cmNov13", "FRB5cmDec13", "FRB5cmJan14", "FRB5cmFeb14", "FRB10cmMar13", "FRB10cmApr13", "FRB10cmMay13", "FRB10cmJun13", "FRB10cmJul13", "FRB10cmAug13", "FRB10cmSep13", "FRB10cmOct13", "FRB10cmNov13", "FRB10cmDec13")
# what are these "FRB5cmJul13__1", "FRB10cmJul13__1" they have values more like FRL than FRB and physically they are within the FRL set of columns (in the exact place of FRL5cmJul and FRL10cmJul)
frb <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=FRB_cols, variable.name='label', value.name='FRB')
frb[, treatment:=factor(treatment)] #CT-control; LA-litter addition; LR-litter removal
frb[, label:=as.character(label)]
frb[, depth:=factor(ifelse(substr(label, 4, 4)=='5', 5, 10))] # depth is 4th character in label
frb[, month:=substr(label, nchar(label)-4, nchar(label)-2)] # month is in label
dry <- c('Jan', 'Feb', 'Mar', 'Apr')
wet <- c("May", "Jun", "Jul", "Aug")
frb[, season:=factor(ifelse(month %in% dry, 'dry', 'wet'))]
frb[, season2:=factor(ifelse(month %in% dry, 'dry',
ifelse(month %in% wet, "wet", "transitional")))]
ic_cols <- c("ICAug13-Oct13", "ICOct13-Jan14", "ICJan14-Apr14")
ic <- melt(root, id.vars=c('treatment', 'plot'), measure.vars=ic_cols, variable.name='label', value.name='frb_prod')
ic[, season:=factor(ifelse(label=="ICAug13-Oct13", "wet",
ifelse(label=="ICOct13-Jan14", "transitional", "dry")))]
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
fit5 <- lmer(form, REML=FALSE, data=frb[depth=="5"])
res5 <- anova(fit5, type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="10"], reml=FALSE)
# FRB ~ season + (1 | plot) + (1 | month)
res10 <- anova(lmer(form, REML=FALSE, data=frb[depth=="10"]), type=3)
my.anova.table <- data.table(response="FRB",
depth=5,
NDF=res5["season", "NumDF"],
DDF=res5["season", "DenDF"],
F=res5["season", "F value"],
p=res5["season", "Pr(>F)"])
my.anova.table <- rbind(my.anova.table,
data.table(response="FRB",
depth=10,
NDF=res10["season", "NumDF"],
DDF=res10["season", "DenDF"],
F=res10["season", "F value"],
p=res10["season", "Pr(>F)"]))
my.anova.table
#(F1, 178 = 10.2, P<0.01, Fig. 1) and at 0-10 cm soil depth (F1, 178 = 14.9, P<0.001, Fig. 1)
their.anova.table <- data.table(response="FRB",
depth=5,
NDF=1,
DDF=178,
F=10.2,
p="P<0.01")
their.anova.table <- rbind(their.anova.table,
data.table(response="FRB",
depth=10,
NDF=1,
DDF=178,
F=14.9,
p="P<0.001"))
their.anova.table
anova(lm(FRB ~ season, data=frb[depth=="5"]))
anova(lm(FRB ~ season, data=frb[depth=="10"]))
frb5 <- frb[depth==5, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb10 <- frb[depth==10, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb_sum <- rbind(data.table(depth=5, frb5), data.table(depth=10, frb10))
frb_sum[, Lower:=FRB-SE]
frb_sum[, Upper:=FRB+SE]
frb_sum[, season:=factor(season, c('wet', 'dry'))]
frb_sum[, treatment:=factor(treatment, c('LR', 'CT', 'LA'))]
pd <- position_dodge(.6)
gg <- ggplot(data=frb_sum, aes(x=season, y=FRB, fill=treatment)) +
geom_col(position=pd, width=0.6, color='black') +
geom_errorbar(aes(ymin=Lower, ymax=Upper), width=.2, position=pd) +
scale_fill_manual(values=c("white", "gray", "black")) +
facet_grid(.~depth, labeller = label_both) +
theme_minimal(base_size=14)
gg
fn <- "fig1.png"
if(knitr_path==TRUE){
image_path <- paste("../images", folder, fn, sep="/")
}else{
image_path <- paste("/images", folder, fn, sep="/")
}
knitr::include_graphics(image_path)
fit5.emm <- emmeans(fit5, specs="treatment")
contrast(fit5.emm, method="revpairwise")
CLD(fit5.emm) # not recommended as this is classification based on arbitrary boundaries
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
fit5.emm <- emmeans(fit5, specs="treatment")
contrast(fit5.emm, method="revpairwise")
CLD(fit5.emm) # not recommended as this is classification based on arbitrary boundaries
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
frb5.fit <- lmer(form, REML=TRUE, data=frb[depth=="5"])
res5 <- anova(frb5.fit, type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="10"], reml=FALSE)
# FRB ~ season + (1 | plot) + (1 | month)
frb10.fit <- anova(lmer(form, REML=TRUE, data=frb[depth=="10"]), type=3)
my.anova.table <- data.table(response="FRB",
depth=5,
NDF=frb5.fit["season", "NumDF"],
DDF=frb5.fit["season", "DenDF"],
F=frb5.fit["season", "F value"],
p=frb5.fit["season", "Pr(>F)"])
frb5.fit
lmer(form, REML=TRUE, data=frb[depth=="5"])
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="5"], reml=FALSE)
# FRB ~ treatment + season + (1 | plot) + (1 | month)
frb5.fit <- lmer(form, REML=TRUE, data=frb[depth=="5"])
frb5.anova <- anova(frb5.fit, type=3)
form <- select_model(y="FRB", x=c('treatment', 'season'), r=c('plot', 'month'), frb[depth=="10"], reml=FALSE)
# FRB ~ season + (1 | plot) + (1 | month)
frb10.anova <- anova(lmer(form, REML=TRUE, data=frb[depth=="10"]), type=3)
my.anova.table <- data.table(response="FRB",
depth=5,
NDF=frb5.anova["season", "NumDF"],
DDF=frb5.anova["season", "DenDF"],
F=frb5.anova["season", "F value"],
p=frb5.anova["season", "Pr(>F)"])
my.anova.table <- rbind(my.anova.table,
data.table(response="FRB",
depth=10,
NDF=frb10.anova["season", "NumDF"],
DDF=frb10.anova["season", "DenDF"],
F=frb10.anova["season", "F value"],
p=frb10.anova["season", "Pr(>F)"]))
frb5 <- frb[depth==5, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb10 <- frb[depth==10, .(N=.N,
FRB=mean(FRB),
SE=sd(FRB)/sqrt(.N)),
by=.(treatment, season)]
frb_sum <- rbind(data.table(depth=5, frb5), data.table(depth=10, frb10))
frb_sum[, Lower:=FRB-SE]
frb_sum[, Upper:=FRB+SE]
frb_sum[, season:=factor(season, c('wet', 'dry'))]
frb_sum[, treatment:=factor(treatment, c('LR', 'CT', 'LA'))]
pd <- position_dodge(.6)
gg <- ggplot(data=frb_sum, aes(x=season, y=FRB, fill=treatment)) +
geom_col(position=pd, width=0.6, color='black') +
geom_errorbar(aes(ymin=Lower, ymax=Upper), width=.2, position=pd) +
scale_fill_manual(values=c("white", "gray", "black")) +
facet_grid(.~depth, labeller = label_both) +
theme_minimal(base_size=14)
gg
fn <- "fig1.png"
if(knitr_path==TRUE){
image_path <- paste("../images", folder, fn, sep="/")
}else{
image_path <- paste("/images", folder, fn, sep="/")
}
knitr::include_graphics(image_path)
fit5.emm <- emmeans(frb5.fit, specs="treatment")
contrast(fit5.emm, method="revpairwise")
CLD(fit5.emm) # not recommended as this is classification based on arbitrary boundaries
form <- select_model(y="frb_prod", x=c('treatment', 'season'), r=c('plot'), ic, reml=FALSE)
# frb_prod ~ season + (1 | plot)
frb_prod.fit <- lmer(form, REML=FALSE, data=ic)
frb_prod.emm <- emmeans(frb_prod.fit, specs="season")
frb_prod.anova <- anova(frb_prod.fit, type=3)
frb_prod.anova
blogdown:::serve_site()
frb5.fit
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
