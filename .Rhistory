pd <- position_dodge(0.9)
gg1c <- ggplot(data=summary(fit5c.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#  geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
fit5.lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
# modeled SE using the full-factorial model and ML fit (not the additive model reported)
fit5b.emm <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5b.emm.response <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.682)
# modeled SE using the additve model and ML fit
fit5c.emm <- emmeans(fit5c, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5c.emm.response <- emmeans(fit5c, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.682)
# full factorial model
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit5b.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
# additive model
pd <- position_dodge(0.9)
gg1c <- ggplot(data=summary(fit5c.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#  geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
fit5_lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer.emm <- emmeans(fit5_lmer, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response")
fit5_lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer.emm.response <- emmeans(fit5_lmer, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# modeled SE using the full-factorial model and ML fit (not the additive model reported)
fit5b.emm <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5b.emm.response <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
fit5_lmer.emm.response
fit5b.emm.response
# modeled SE using the full-factorial model and ML fit (not the additive model reported)
fit5b.emm <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5b.emm.response <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
fit5_lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer.emm.response <- emmeans(fit5_lmer, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit5b.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
# lmer
pd <- position_dodge(0.9)
gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#  geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
# modeled SE using the full-factorial model and ML fit (not the additive model reported)
fit5b.emm <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5b.emm.response <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
fit5_lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer.emm.response <- emmeans(fit5_lmer, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit5b.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
# lmer
pd <- position_dodge(0.9)
gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#  geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
# modeled SE using the full-factorial model and ML fit (not the additive model reported)
fit5b.emm <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"))
fit5b.emm.response <- emmeans(fit5b, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
fit5_lmer <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT*CAGE_TREAT*NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer.emm.response <- emmeans(fit5_lmer, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit5b.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
# lmer
pd <- position_dodge(0.9)
gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#eom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
blogdown:::serve_site()
shoot[, biomass_present:=ifelse(is.na(ShootDW_g,0,1))]
shoot[, biomass_present:=ifelse(is.na(ShootDW_g),0,1))]
shoot[, biomass_present:=ifelse(is.na(ShootDW_g),0,1)]
shoot[, .(N=sum(biomass_present)), by=.(CAGE_TREAT, DENSITY_TREAT, NUTRIENT_TREAT, SITE)]
shoot[, biomass_present:=ifelse(is.na(ShootDW_g),0,1)]
shoot[, .(N=sum(biomass_present)), by=.(CAGE_TREAT, DENSITY_TREAT, NUTRIENT_TREAT, SITE)]
qplot(shoot$N)
shoot[, biomass_present:=ifelse(is.na(ShootDW_g),0,1)]
counts <- shoot[, .(N=sum(biomass_present)), by=.(CAGE_TREAT, DENSITY_TREAT, NUTRIENT_TREAT, SITE)]
qplot(counts$N)
80*144
80*144
# refit adidtive model with lmer
fit5_lmer_add <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit5_lmer_add.emm.response <- emmeans(fit5_lmer_add, specs=c("DENSITY_TREAT", "CAGE_TREAT","NUTRIENT_TREAT"), type="response", level=0.68)
pd <- position_dodge(0.9)
gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
#geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1d
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit5_lmer_add, specs=c("DENSITY_TREAT"))
contrast(fit.emm, method="revpairwise", adjust="none")
fit.emm
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit5_lmer_add, specs=c("DENSITY_TREAT","CAGE_TREAT","NUTRIENT_TREAT"))
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit5_lmer_add, specs=c("DENSITY_TREAT","CAGE_TREAT","NUTRIENT_TREAT"))
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
#
# # lmer
# pd <- position_dodge(0.9)
# gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   #geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit5_lmer_add, specs=c("CAGE_TREAT"))
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
#
# # lmer
# pd <- position_dodge(0.9)
# gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   #geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit, specs=c("CAGE_TREAT"))
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
#
# # lmer
# pd <- position_dodge(0.9)
# gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   #geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit, specs=c("CAGE_TREAT"))
fit.emm
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
#
# # lmer
# pd <- position_dodge(0.9)
# gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   #geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=TRUE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit, specs=c("CAGE_TREAT"))
fit.emm
contrast(fit.emm, method="revpairwise", adjust="none")
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
#
# # lmer
# pd <- position_dodge(0.9)
# gg1c <- ggplot(data=summary(fit5_lmer.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   #geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
coef(summary(fit))
coef(summary(fit))
newdat <- data.frame(levels(shoot$CAGE_TREAT))
newdat$distance <- predict(fit, newdat, re.form=NA)
newdat <- expand.grid(levels(shoot$DENSITY_TREAT), levels(shoot$CAGE_TREAT), levels(shoot$NUTRIENT_TREAT))
newdat$distance <- predict(fit, newdat, re.form=NA)
newdat
newdat <- expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT))
newdat$distance <- predict(fit, newdat, re.form=NA)
names(shoot)
newdat <- data.table(expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT)))
newdat[, wind_fetch:=0]
newdat[, Actual_Retention_time:=0]
newdat$distance <- predict(fit, newdat, re.form=NA)
newdat
mm
fit.emm2 <- data.table(expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT)))
fit.emm2[, wind_fetch:=0]
fit.emm2[, Actual_Retention_time:=0]
fit.emm2[, emmean:=predict(fit, newdat, re.form=NA)]
mm <- model.matrix(terms(fit), fit.emm2)
coef(fit)
fit
fit.emm2
terms(fit)
?model.matrix
newdat <- expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT))
newdat$wind_fetch <- 0
newdat$ Actual_Retention_time <- 0
fit.emm2 <- data.table(newdat)
fit.emm2[, emmean:=predict(fit, newdat, re.form=NA)]
fit.emm2
terms(fit)
terms(fit)
sqrt(diag(mm %*% tcrossprod(vcov(fit), mm)))
mm <- model.matrix(~~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time, newdat)
sqrt(diag(mm %*% tcrossprod(vcov(fit), mm)))
# mm <- model.matrix(terms(fit), fit.emm2)
## or newdat$distance <- mm %*% fixef(fm1)
fit.emm2[, SE:=sqrt(diag(mm %*% tcrossprod(vcov(fit), mm)))]
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit, specs=c("CAGE_TREAT"))
fit.emm
contrast(fit.emm, method="revpairwise", adjust="none")
newdat <- expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT))
newdat$wind_fetch <- 0
newdat$ Actual_Retention_time <- 0
fit.emm2 <- data.table(newdat)
fit.emm2[, emmean:=predict(fit, newdat, re.form=NA)]
mm <- model.matrix(~~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time, newdat)
# mm <- model.matrix(terms(fit), fit.emm2)
## or newdat$distance <- mm %*% fixef(fm1)
fit.emm2[, SE:=sqrt(diag(mm %*% tcrossprod(vcov(fit), mm)))]
t_crit <- 1.96
fit.emm2[, lower.CL:=emmean-t_crit]
fit.emm2[, upper.CL:=emmean+t_crit]
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
pd <- position_dodge(0.9)
gg1c <- ggplot(data=fit.emm2, aes(x=CAGE_TREAT, y=emmean, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
fit.emm.full <- emmeans(fit, specs=c("CAGE_TREAT", "DENSITY_TREAT","NUTRIENT_TREAT"))
fit.emm.full
fit.emm2
# After 12 weeks, epiphytic algae biomass was 2.4 times higher in the large predatory fish exclosures (closed cages) than the fish access (open) cages but was unaffected by nutrient enrichment and plant density (main effect of cage treatment, F1,19 = 6.12, P = 0.020, Appendix S5, Fig. 2A).
# refit model with lmer, I prefer the "(1|SITE) + (1|SITE:CAGE_ID)" specification
# refit adidtive model with lmer
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit.emm <- emmeans(fit, specs=c("CAGE_TREAT"))
fit.emm
contrast(fit.emm, method="revpairwise", adjust="none")
fit.emm.full <- emmeans(fit, specs=c("CAGE_TREAT", "DENSITY_TREAT","NUTRIENT_TREAT"))
newdat <- expand.grid(DENSITY_TREAT=levels(shoot$DENSITY_TREAT),
CAGE_TREAT=levels(shoot$CAGE_TREAT),
NUTRIENT_TREAT=levels(shoot$NUTRIENT_TREAT))
newdat$wind_fetch <- 0
newdat$ Actual_Retention_time <- 0
fit.emm2 <- data.table(newdat)
fit.emm2[, emmean:=predict(fit, newdat, re.form=NA)]
mm <- model.matrix(~~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time, newdat)
# mm <- model.matrix(terms(fit), fit.emm2)
## or newdat$distance <- mm %*% fixef(fm1)
fit.emm2[, SE:=sqrt(diag(mm %*% tcrossprod(vcov(fit), mm)))]
t_crit <- 1.96
fit.emm2[, lower.CL:=emmean-t_crit]
fit.emm2[, upper.CL:=emmean+t_crit]
# lme "containment" SE
pd <- position_dodge(0.9)
gg1b <- ggplot(data=summary(fit.emm), aes(x=CAGE_TREAT, y=emmean)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1b
pd <- position_dodge(0.9)
gg1c <- ggplot(data=fit.emm2, aes(x=CAGE_TREAT, y=emmean, fill=DENSITY_TREAT)) +
geom_col(position=pd) +
geom_errorbar(aes(ymin=emmean-SE, ymax=emmean+SE), width=0.2, position=pd) +
#geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
facet_wrap(.~NUTRIENT_TREAT) +
NULL
gg1c
#
# # lmer
# pd <- position_dodge(0.9)
# gg1d <- ggplot(data=summary(fit5_lmer_add.emm.response), aes(x=CAGE_TREAT, y=response, fill=DENSITY_TREAT)) +
#   geom_col(position=pd) +
#   #geom_errorbar(aes(ymin=response-SE, ymax=response+SE), width=0.2, position=pd) +
#   geom_errorbar(aes(ymin=lower.CL, ymax=upper.CL), width=0.2, position=pd) +
#   facet_wrap(.~NUTRIENT_TREAT) +
#   NULL
# gg1d
# large SEs reflect the clustered data but this should really be modeled with a GLM
?tcrossprod
vcov(fit)
vcov(fit)
coef(summary(Fit))
coef(summary(fit))
sqrt(.745)
sqrt(diag(vcov(fit)))
mm
dim(vcov(fit))
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
fit <- lmer(sqrt(scaled_Strictly_epiphytic_algae_DW_g_Myrio) ~ DENSITY_TREAT + CAGE_TREAT + NUTRIENT_TREAT + wind_fetch + Actual_Retention_time + (1|SITE) + (1|SITE:CAGE_ID), REML=FALSE, data=shoot, na.action=na.exclude)
summary(fit)
names(fit)
names(summary(fit))
summary(fit)$sigma
x <- matrix(c(rep(1,10), rep(0,5), rep(1,5)), ncol=2)
x
xtx <- t(x)%*%x
xtx
solv(xtx)
solve(xtx)
